# Настройка модуля
<!-- settings-start -->

## 1. Переходим в настройки модуля

`Настройки` -> `Настройки продукта` -> `Настройки модулей` -> `AWZ: Форма авторизации`

![](https://zahalski.dev/images/modules/awz.autform/001.png)

## 2. Параметры модуля

| Параметр | Описание |
|---|---|
| Срок действия кода в минутах | Через столько времени пользователь сможет запросить повторный код |
| Максимальное количество попыток ввода кода | Следующие после лимита попытки ввода кода проверяться не будут<br> Для дальнейшего входа пользователю необходимо получить новый код (через время в параметре выше)|
| Количество кодов за сутки | Максимальное количество кодов за последние 24 часа |
| Количество кодов за час | Максимальное количество кодов за последние 60 минут |

| Группа параметров | Описание |
|---|---|
| Общие лимиты генерации кодов | Учитываются общее количество запрошенных кодов за отведенное время<br> Настройте параметры, чтобы избежать возможных атак на массовые отправки запросов и сжигание баланса на сервисе |
| Лимиты генерации кодов по ip адресу | Учитываются общее количество запрошенных кодов за отведенное время для одного IP адреса |
| Лимиты генерации кодов по номеру телефона | Учитываются общее количество запрошенных кодов за отведенное время для одного номера телефона |

*Есть возможность переопределения стандартных механизмов обработчиком `onCheckLimits`, а также возможность отловить результаты проверки обработчиком `onCheckCode`*

## 3. Размещаем компонент формы авторизации

- В меню компонентов в редакторе переходим в `Zahalski.dev` -> `Пользователь` -> `Форма авторизации`
- Нажимаем на иконку компонента и переходим в его настройки
- После настройки компонента сохраняем страницу

![](https://zahalski.dev/images/modules/awz.autform/002.png)

![](https://zahalski.dev/images/modules/awz.autform/003.png)

### Описание параметров компонента

#### Группа шаблон компонента

Тут один параметр "Шаблон компонента" - выбираем необходимый (по умолчанию `.default`)

#### Группа Общие параметры

![](https://zahalski.dev/images/modules/awz.autform/004.png)

| Параметр | Описание |
|---|---|
| Код страны | Международный код страны<br> Для РФ: 7, Для Беларуси: 375 и т.п. |
| Ссылка на личный кабинет | Будет выведена вместо ссылки на авторизацию, если пользователь уже авторизован |
| Идентификатор соглашения | Выберите соглашение в системе, чтобы соблюдать Закон № 152-ФЗ о персональных данных<br> Соглашения настраиваются стандартно в админ. панели `Настройки` -> `Настройки продукта` -> `Соглашения` |
| Тип языковых сообщений | Если планируется отправка смс кодов, то смс<br> Если планируется по звонку, то звонок |
| Искать пользователей состоящих в одной из групп | Поиск пользователей будет происходит только в данных группах<br> Пользователь должен состоять в одной из отмеченных тут групп |
| Исключить ид пользователей из поиска | Вы можете указать ИД пользователей через запятую, которых исключить из поиска<br> Например пользователя на которого оформляются заказы с внешней интеграции |
| Порядок поиска пользователя по номеру |  |
| - пользователь | Поиск пользователя будет осуществляться только в таблице пользователей битрикса<br> Поля по умолчанию: PERSONAL_PHONE, PERSONAL_MOBILE, LOGIN |
| - заказ | Поиск осуществляется только по коду свойства заказа и если заказ будет найден для авторизации будет выбран пользователь с заказа<br> Такой пользователь также должен состоять в группах настроенных для поиска выше в параметрах |
| - пользователь, заказ | сперва будет попытка поиска по логике пользователь, и если не найден по логике заказ |
| - заказ, пользователь | сперва будет попытка поиска по логике заказ, и если не найден по логике пользователь |
| Код свойства заказа с номером телефона | Выберите код свойства в котором хранится номер телефона<br> Настройка игнорируется, если логика не подразумевает поиска по заказам или модуль sale не установлен |
| Цветовая схема | Некоторые шаблоны могут поддерживать разные цветовые схемы компонента |

#### Группа Авторизация по паролю

![](https://zahalski.dev/images/modules/awz.autform/005.png)

*Для запрета вывода авторизации по паролю необходимо оставить пустым настройку разрешения групп (руппы для которых разрешена авторизация)*

| Параметр | Описание |
|---|---|
| Группы для которых разрешена авторизация | Если пользователь состоит в одной из групп ниже, авторизация по паролю пользователя будет разрешена,<br> Иначе пользователь получит сообщение об ошибке |
| Группы для которых запрещена авторизация | Можно отключить возможность авторизации по паролю для одной из групп (например, Администраторы) |
| Искать пользователя по логину | Активируйте опцию, если нужна проверка стандартного алгоритма авторизации (по логину и паролю) |

#### Группа Авторизация по смс

![](https://zahalski.dev/images/modules/awz.autform/006.png)

*Для запрета вывода авторизации по смс необходимо оставить пустым настройку разрешения групп (Группы для которых разрешен вход по смс)*

| Параметр | Описание |
|---|---|
| Группы для которых разрешен вход по смс | Если пользователь состоит в одной из групп ниже, авторизация через смс или звонок будет разрешена,<br> Иначе пользователь получит сообщение об ошибке |
| Группы для которых запрещен вход по смс | Можно отключить возможность авторизации через смс или звонок для одной из групп (например, Администраторы) |

#### Регистрация по смс

![](https://zahalski.dev/images/modules/awz.autform/007.png)

*Для запрета регистрации по смс необходимо оставить пустым настройку разрешения групп (Группы в которые регистрировать пользователей)*

| Параметр | Описание |
|---|---|
| Группы в которые регистрировать пользователей | В данные группы будет зарегистрирован новый пользователь,<br> Обратите внимание, что регистрация в группу Администраторов невозможна (при отметке опции параметры не будут учитываться) |
| Объединить регистрацию и авторизацию по смс | Опция служит для объединения входа по смс и регистрации, в случае если пользователь не найден по номеру телефона он будет зарегистрирован как новый |

## 4. Настраиваем интеграцию с транспортом (сервисом смс/звонков)

<!-- settings-end -->

### 4.1 [Настройка смс через модуль mlife.smsservices](https://github.com/zahalski/awz.autform/tree/main/docs/settsms.md)
### 4.2 [Настройка звонков через модуль awz.flashcallapi](https://github.com/zahalski/awz.autform/tree/main/docs/settcall.md)
### 4.3 [Настройка через свой шлюз или модуль](https://github.com/zahalski/awz.autform/tree/main/docs/settany.md)
